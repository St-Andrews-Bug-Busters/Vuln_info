***CVE-2024-48241***

**Description** \
In the following file of project radare2:

https://github.com/radareorg/radare2/blob/master/shlr/qjs/src/libbf.c#L1697

At line 1697 inside function `__bf_div` there exists a security vulnerability due to the lack of a check for correctness of allocation in 

`taba = bf_malloc(s, (na + 1) * sizeof(limb_t));`

The second argument could result in an unsigned integer overflow if `(na + 1) * sizeof(limb_t)` exceeds SIZE_T_MAX. Since na is assigned as:

`na = n + nb;`

and nb assigned as: 

`nb = b->len;`

where b is a parameter of the function:

`static int __bf_div(bf_t *r, const bf_t *a, const bf_t *b, limb_t prec,
                    bf_flags_t flags);`

This makes it possible to manually trigger the overflow. 

**Affected Version** \
5.8.0 through 5.9.4

**Impact** \
memset is performed subsequently, after the allocation:

`d = na - a->len;`
`memset(taba, 0, d * sizeof(limb_t));`

This would potentially lead to a out-of-bound write on taba, hence typically resulting in a crash.

**Suggested Fix**
```        limb_t *taba, na;
        slimb_t d;

        na = n + nb;

+       if (na >= (SIZE_MAX / sizeof(limb_t)) - 1) {
+           return BF_ST_MEM_ERROR;  /* Return memory error status */
+       }

        taba = bf_malloc(s, (na + 1) * sizeof(limb_t));
```

**References** \
[https://github.com/radareorg/radare2/pull/23318](https://github.com/radareorg/radare2/pull/23318) \
[https://github.com/radareorg/radare2/issues/23317](https://github.com/radareorg/radare2/issues/23317)


**Credits** \
Sherlock Fang, Vlad Tronciu, Ayam Babu
